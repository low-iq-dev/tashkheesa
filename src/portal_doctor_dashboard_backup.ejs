<%
  const isAr = (typeof lang !== 'undefined' && lang === 'ar');
  const _files = Array.isArray(files) ? files : [];
%>

<!DOCTYPE html>
<html lang="<%= isAr ? 'ar' : 'en' %>" dir="<%= isAr ? 'rtl' : 'ltr' %>">
<head>
  <meta charset="UTF-8" />
  <title>Case</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="portal-layout">

  <!-- CASE HEADER -->
  <header class="portal-topbar">
    <div class="topbar-left">
      <strong><%= order.reference || order.id %></strong>
    </div>
    <div class="topbar-right">
      <span class="status-pill"><%= statusLabel %></span>
      <span class="sla-pill"><%= slaLabel %></span>
    </div>
  </header>

  <main class="case-workspace">

    <!-- SUMMARY -->
    <section class="card">
      <h2><%= isAr ? 'ملخص الحالة' : 'Case summary' %></h2>
      <div class="summary-grid">
        <div>
          <label><%= isAr ? 'الخدمة' : 'Service' %></label>
          <div><%= order.service_name || '—' %></div>
        </div>
        <div>
          <label><%= isAr ? 'التخصص' : 'Specialty' %></label>
          <div><%= order.specialty || '—' %></div>
        </div>
      </div>
    </section>

    <!-- CLINICAL CONTEXT -->
    <section class="card">
      <h2><%= isAr ? 'السياق الطبي' : 'Clinical context' %></h2>
      <p><strong><%= isAr ? 'سؤال المريض:' : 'Patient question:' %></strong></p>
      <p><%= clinicalContext?.question || '—' %></p>
    </section>

    <!-- FILES -->
    <section class="card">
      <h2><%= isAr ? 'الملفات' : 'Files' %></h2>

      <% if (_files.length) { %>
        <ul class="file-list">
          <% _files.forEach(f => { %>
            <li>
              <a href="<%= f.url %>" target="_blank"><%= f.name %></a>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <div class="empty-state">
          <%= isAr ? 'لا توجد ملفات.' : 'No files uploaded.' %>
        </div>
      <% } %>
    </section>

    <!-- ACTIONS -->
    <section class="card card-accent">
      <h2><%= isAr ? 'إجراءات الطبيب' : 'Doctor actions' %></h2>

      <form method="POST" action="/portal/doctor/case/<%= order.id %>/diagnosis">
        <label><%= isAr ? 'الملاحظات الطبية' : 'Medical notes' %></label>
        <textarea name="diagnosis" rows="6"></textarea>
        <button class="btn-primary">
          <%= isAr ? 'حفظ' : 'Save' %>
        </button>
      </form>
    </section>

  </main>
</body>
</html>
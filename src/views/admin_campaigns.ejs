<%- include('partials/header', { title: pageTitle || "Email Campaigns", layout: "portal", showNav: false, portalFrame: true, portalRole: (typeof portalRole !== 'undefined' ? portalRole : 'superadmin'), portalActive: 'campaigns' }) %>
<%
  var _lang = (typeof lang !== 'undefined') ? lang : 'en';
  var _isAr = (typeof isAr !== 'undefined') ? isAr : false;
  var _campaigns = (typeof campaigns !== 'undefined' && Array.isArray(campaigns)) ? campaigns : [];
%>

<div class="admin-page">
  <div class="admin-page-header">
    <div class="admin-page-header-left">
      <nav class="admin-breadcrumb">
        <a href="/admin">Dashboard</a>
        <span class="admin-breadcrumb-sep">&rsaquo;</span>
        <span>Campaigns</span>
      </nav>
      <h1 class="admin-page-title"><%= _isAr ? 'حملات البريد الإلكتروني' : 'Email Campaigns' %></h1>
    </div>
    <div class="admin-page-header-right">
      <a class="admin-btn admin-btn-primary" href="/portal/admin/campaigns/new">
        + <%= _isAr ? 'حملة جديدة' : 'New Campaign' %>
      </a>
    </div>
  </div>

  <div class="admin-table-wrap">
    <table class="admin-table">
      <thead>
        <tr>
          <th><%= _isAr ? 'الاسم' : 'Name' %></th>
          <th><%= _isAr ? 'الجمهور' : 'Audience' %></th>
          <th><%= _isAr ? 'الحالة' : 'Status' %></th>
          <th><%= _isAr ? 'المستلمون' : 'Recipients' %></th>
          <th><%= _isAr ? 'مرسل' : 'Sent' %></th>
          <th><%= _isAr ? 'فشل' : 'Failed' %></th>
          <th><%= _isAr ? 'تاريخ الإنشاء' : 'Created' %></th>
          <th><%= _isAr ? 'إجراءات' : 'Actions' %></th>
        </tr>
      </thead>
      <tbody>
        <% if (_campaigns.length === 0) { %>
          <tr><td colspan="8" class="empty"><%= _isAr ? 'لا توجد حملات بعد' : 'No campaigns yet' %></td></tr>
        <% } %>
        <% _campaigns.forEach(function(c) { %>
          <tr>
            <td><a href="/portal/admin/campaigns/<%= c.id %>" class="cell-bold"><%= c.name %></a></td>
            <td><%= c.target_audience %></td>
            <td>
              <%
                var pillClass = 'status-pill--new';
                if (c.status === 'sent') { pillClass = 'status-pill--completed'; }
                else if (c.status === 'sending') { pillClass = 'status-pill--in_review'; }
                else if (c.status === 'scheduled') { pillClass = 'status-pill--new'; }
                else if (c.status === 'cancelled') { pillClass = 'status-pill--cancelled'; }
                else if (c.status === 'draft') { pillClass = 'status-pill--accepted'; }
              %>
              <span class="status-pill <%= pillClass %>">
                <%= c.status %>
              </span>
            </td>
            <td><%= c.total_recipients || 0 %></td>
            <td><%= c.total_sent || 0 %></td>
            <td><%= c.total_failed || 0 %></td>
            <td><span class="cell-muted"><%= c.created_at ? new Date(c.created_at).toLocaleDateString() : '-' %></span></td>
            <td>
              <a href="/portal/admin/campaigns/<%= c.id %>" class="admin-btn admin-btn-outline"><%= _isAr ? 'عرض' : 'View' %></a>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>
</div>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

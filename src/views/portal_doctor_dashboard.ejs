<%
  const isAr = (locals.lang === 'ar');

  const activeCases = Array.isArray(locals.activeCases)
    ? locals.activeCases
    : [];

  const availableCases = Array.isArray(locals.availableCases)
    ? locals.availableCases
    : [];

  const completedCases = Array.isArray(locals.completedCases)
    ? locals.completedCases
    : [];

  const user = locals.user || {};
%>

<!DOCTYPE html>
<html lang="<%= isAr ? 'ar' : 'en' %>" dir="<%= isAr ? 'rtl' : 'ltr' %>">
<head>
  <meta charset="UTF-8" />
  <title><%= isAr ? 'بوابة الطبيب' : 'Doctor Portal' %></title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body class="portal-layout">

  <!-- TOP BAR -->
  <header class="portal-topbar">
    <div class="topbar-left">
      <strong>
        <%= isAr ? 'مرحباً' : 'Welcome back' %>,
        <%= user && user.name ? user.name : (isAr ? 'الطبيب' : 'Doctor') %>
      </strong>
      <% if (user && user.specialty) { %>
        <div class="muted"><%= user.specialty %></div>
      <% } %>
    </div>
  </header>

  <main class="portal-main">

    <!-- LEFT MODE RAIL -->
    <aside class="portal-rail">
      <button class="rail-item active" data-target="active">
        <%= isAr ? 'الحالات النشطة' : 'Active' %>
      </button>
      <button class="rail-item" data-target="available">
        <%= isAr ? 'حالات متاحة' : 'Available' %>
      </button>
      <button class="rail-item" data-target="completed">
        <%= isAr ? 'مكتملة' : 'Completed' %>
      </button>
    </aside>

    <!-- CENTER WORKSPACE -->
    <section class="portal-workspace">

      <!-- ACTIVE CASES -->
      <section class="card workspace-panel" id="panel-active">
        <h2><%= isAr ? 'حالاتك النشطة' : 'Your active cases' %></h2>

        <% if (activeCases.length) { %>
          <ul class="case-list">
            <% activeCases.forEach(function(c) { %>
              <li class="case-row">
                <div class="case-meta">
                  <strong><%= c.reference || c.id %></strong>
                  <div class="muted"><%= c.service_name || '' %></div>
                </div>
                <a class="btn-primary" href="/portal/doctor/case/<%= c.id %>">
                  <%= isAr ? 'فتح' : 'Open' %>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <div class="empty-state">
            <%= isAr ? 'لا توجد حالات نشطة حالياً.' : 'You have no active cases at the moment.' %>
          </div>
        <% } %>
      </section>

      <!-- AVAILABLE CASES -->
      <section class="card workspace-panel hidden" id="panel-available">
        <h2><%= isAr ? 'حالات متاحة' : 'Available cases' %></h2>

        <% if (availableCases.length) { %>
          <ul class="case-list">
            <% availableCases.forEach(function(c) { %>
              <li class="case-row">
                <div class="case-meta">
                  <strong><%= c.reference || c.id %></strong>
                  <div class="muted"><%= c.service_name || '' %></div>
                </div>
                <a class="btn-secondary" href="/portal/doctor/case/<%= c.id %>">
                  <%= isAr ? 'عرض' : 'View' %>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <div class="empty-state">
            <%= isAr ? 'لا توجد حالات متاحة حالياً.' : 'No available cases right now.' %>
          </div>
        <% } %>
      </section>

      <!-- COMPLETED CASES -->
      <section class="card workspace-panel hidden" id="panel-completed">
        <h2><%= isAr ? 'حالات مكتملة' : 'Completed cases' %></h2>

        <% if (completedCases.length) { %>
          <ul class="case-list">
            <% completedCases.forEach(function(c) { %>
              <li class="case-row">
                <div class="case-meta">
                  <strong><%= c.reference || c.id %></strong>
                  <div class="muted"><%= c.service_name || '' %></div>
                </div>
                <a class="btn-link" href="/portal/doctor/case/<%= c.id %>">
                  <%= isAr ? 'عرض' : 'View' %>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <div class="empty-state">
            <%= isAr ? 'لا توجد حالات مكتملة بعد.' : 'No completed cases yet.' %>
          </div>
        <% } %>
      </section>

    </section>
  </main>

  <!-- Lightweight rail switching (no framework) -->
  <script>
    (function () {
      const buttons = document.querySelectorAll('.rail-item');
      const panels = document.querySelectorAll('.workspace-panel');

      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          buttons.forEach(b => b.classList.remove('active'));
          panels.forEach(p => p.classList.add('hidden'));

          btn.classList.add('active');
          const target = document.getElementById('panel-' + btn.dataset.target);
          if (target) target.classList.remove('hidden');
        });
      });
    })();
  </script>

</body>
</html>
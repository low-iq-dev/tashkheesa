<%
  const isAr = (locals.lang === 'ar');

  const activeCases = Array.isArray(locals.activeCases)
    ? locals.activeCases
    : [];

  const availableCases = Array.isArray(locals.availableCases)
    ? locals.availableCases
    : [];

  const completedCases = Array.isArray(locals.completedCases)
    ? locals.completedCases
    : [];

  const user = locals.user || {};
%>

<!DOCTYPE html>
<html lang="<%= isAr ? 'ar' : 'en' %>" dir="<%= isAr ? 'rtl' : 'ltr' %>">
<head>
  <meta charset="UTF-8" />
  <title>Doctor Portal</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="portal-layout">

  <!-- TOP BAR -->
  <header class="portal-topbar">
    <div class="topbar-left">
      <strong>
        <%= isAr ? 'مرحباً' : 'Welcome back' %>,
        <%= user && user.name ? user.name : (isAr ? 'الطبيب' : 'Doctor') %>
      </strong>
      <div class="muted">
        <%= user && user.specialty ? user.specialty : '' %>
      </div>
    </div>
  </header>

  <main class="portal-main">

    <!-- LEFT MODE RAIL -->
    <aside class="portal-rail">
      <button class="rail-item active">
        <%= isAr ? 'الحالات النشطة' : 'Active' %>
      </button>
      <button class="rail-item">
        <%= isAr ? 'حالات متاحة' : 'Available' %>
      </button>
      <button class="rail-item">
        <%= isAr ? 'مكتملة' : 'Completed' %>
      </button>
    </aside>

    <!-- CENTER WORKSPACE -->
    <section class="portal-workspace">

      <!-- ACTIVE CASES -->
      <section class="card">
        <h2><%= isAr ? 'حالاتك النشطة' : 'Your active cases' %></h2>

        <% if (activeCases.length) { %>
          <ul class="case-list">
            <% activeCases.forEach(function(c) { %>
              <li class="case-row">
                <div>
                  <strong><%= c.reference || c.id %></strong>
                  <div class="muted"><%= c.service_name || '' %></div>
                </div>
                <a class="btn-primary" href="/portal/doctor/case/<%= c.id %>">
                  <%= isAr ? 'فتح' : 'Open' %>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <div class="empty-state">
            <%= isAr ? 'لا توجد حالات نشطة حالياً.' : 'You have no active cases at the moment.' %>
          </div>
        <% } %>
      </section>

      <!-- AVAILABLE CASES -->
      <section class="card">
        <h2><%= isAr ? 'حالات متاحة' : 'Available cases' %></h2>

        <% if (availableCases.length) { %>
          <ul class="case-list">
            <% availableCases.forEach(function(c) { %>
              <li class="case-row">
                <div>
                  <strong><%= c.reference || c.id %></strong>
                  <div class="muted"><%= c.service_name || '' %></div>
                </div>
                <a class="btn-secondary" href="/portal/doctor/case/<%= c.id %>">
                  <%= isAr ? 'عرض' : 'View' %>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <div class="empty-state">
            <%= isAr ? 'لا توجد حالات متاحة حالياً.' : 'No available cases right now.' %>
          </div>
        <% } %>
      </section>

      <!-- COMPLETED CASES -->
      <section class="card">
        <h2><%= isAr ? 'حالات مكتملة' : 'Completed cases' %></h2>

        <% if (completedCases.length) { %>
          <ul class="case-list">
            <% completedCases.forEach(function(c) { %>
              <li class="case-row">
                <div>
                  <strong><%= c.reference || c.id %></strong>
                  <div class="muted"><%= c.service_name || '' %></div>
                </div>
                <a class="btn-link" href="/portal/doctor/case/<%= c.id %>">
                  <%= isAr ? 'عرض' : 'View' %>
                </a>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <div class="empty-state">
            <%= isAr ? 'لا توجد حالات مكتملة بعد.' : 'No completed cases yet.' %>
          </div>
        <% } %>
      </section>

    </section>
  </main>
</body>
</html>
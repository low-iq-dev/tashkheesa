<!DOCTYPE html>
<% const isAr = (typeof lang !== 'undefined' && lang === 'ar'); %>
<%
  var activeCases = Array.isArray(locals.activeCases) ? locals.activeCases : [];
  var availableCases = Array.isArray(locals.availableCases) ? locals.availableCases : [];
  var completedCases = Array.isArray(locals.completedCases) ? locals.completedCases : [];
%>
<html lang="<%= lang || 'en' %>" dir="<%= isAr ? 'rtl' : 'ltr' %>">
<head>
  <meta charset="utf-8" />
  <title>Doctor Portal ‚Äì <%= brand %></title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <div class="layout">
    <header>
      <div class="brand">
        <div class="brand-logo">T</div>
        <div>
          <div class="brand-text-main"><%= brand %></div>
          <div class="brand-text-sub"><%= isAr ? 'ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ®' : 'Doctor portal' %></div>
        </div>
      </div>

      <div class="header-right">
        <div class="pill">üë®‚Äç‚öïÔ∏è <%= (user && user.name) || 'Doctor' %></div>
        <form class="logout-form" method="post" action="/logout">
          <button type="submit"><%= t('nav.logout') %></button>
        </form>
      </div>
    </header>

    <main>
      <div class="page-shell portal-page">
        <div class="page-inner">

          <!-- DOCTOR WELCOME -->
          <section class="doctor-home-welcome">
            <div class="doctor-avatar">
              <img
                src="<%= (user && user.photo) ? user.photo : '/images/doctor-placeholder.png' %>"
                alt="Doctor photo"
              />
            </div>

            <div class="doctor-welcome-text">
              <h1>
                <%= isAr ? 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ÿπŸàÿØÿ™ŸÉÿå ÿØŸÉÿ™Ÿàÿ±' : 'Welcome back, Dr.' %>
                <%= user && user.lastName ? user.lastName : user.name %>
              </h1>

              <p class="doctor-specialty">
                <%= user.specialty || '' %>
                <% if (user.subSpecialty) { %>
                  ¬∑ <%= user.subSpecialty %>
                <% } %>
              </p>
            </div>
          </section>

          <!-- ACTIVE CASES -->
          <section class="doctor-home-section primary">
            <h2><%= isAr ? 'ÿ≠ÿßŸÑÿßÿ™ŸÉ ÿßŸÑŸÜÿ¥ÿ∑ÿ©' : 'Your active cases' %></h2>

            <% if (activeCases && activeCases.length) { %>
              <div class="case-list">
                <% activeCases.forEach(function(c) { %>
                  <div class="case-row">
                    <div class="case-main">
                      <div class="case-ref"><%= c.reference %></div>
                      <div class="case-meta"><%= c.specialtyLabel %></div>
                    </div>

                    <div class="case-status">
                      <span class="status-pill"><%= c.statusLabel %></span>
                      <span class="sla-time"><%= c.slaLabel %></span>
                    </div>

                    <div class="case-action">
                      <a href="<%= c.href %>" class="btn btn-primary">
                        <%= isAr ? 'ŸÅÿ™ÿ≠ ÿßŸÑÿ≠ÿßŸÑÿ©' : 'Open case' %>
                      </a>
                    </div>
                  </div>
                <% }); %>
              </div>
            <% } else { %>
              <p class="empty-state">
                <%= isAr
                  ? 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÑÿØŸäŸÉ ÿ≠ÿßŸÑÿßÿ™ ŸÜÿ¥ÿ∑ÿ© ÿ≠ÿßŸÑŸäÿßŸã.'
                  : 'You have no active cases at the moment.'
                %>
              </p>
            <% } %>
          </section>

          <!-- AVAILABLE CASES -->
          <section class="doctor-home-section secondary">
            <h2><%= isAr ? 'ÿ≠ÿßŸÑÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©' : 'Available cases' %></h2>
            <p class="section-hint">
              <%= isAr
                ? 'ÿ≠ÿßŸÑÿßÿ™ ŸäŸÖŸÉŸÜŸÉ ÿßÿÆÿ™Ÿäÿßÿ± ŸÇÿ®ŸàŸÑŸáÿß ÿ≠ÿ≥ÿ® ÿ™ÿÆÿµÿµŸÉ.'
                : 'Cases you may choose to accept based on your specialty.'
              %>
            </p>

            <% if (availableCases && availableCases.length) { %>
              <div class="case-list muted">
                <% availableCases.forEach(function(c) { %>
                  <div class="case-row">
                    <div class="case-main">
                      <div class="case-ref"><%= c.reference %></div>
                      <div class="case-meta"><%= c.specialtyLabel %></div>
                    </div>

                    <div class="case-status">
                      <span class="status-pill"><%= c.statusLabel %></span>
                      <span class="sla-time"><%= c.slaLabel %></span>
                    </div>

                    <div class="case-action">
                      <a href="<%= c.acceptHref %>" class="btn btn-outline">
                        <%= isAr ? 'ŸÇÿ®ŸàŸÑ' : 'Accept' %>
                      </a>
                    </div>
                  </div>
                <% }); %>
              </div>
            <% } else { %>
              <p class="empty-state muted">
                <%= isAr
                  ? 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿßŸÑÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ© ÿ≠ÿßŸÑŸäÿßŸã.'
                  : 'No available cases at the moment.'
                %>
              </p>
            <% } %>
          </section>

          <!-- COMPLETED CASES -->
          <section class="doctor-home-section tertiary">
            <h2><%= isAr ? 'ÿ≠ÿßŸÑÿßÿ™ ŸÖŸÉÿ™ŸÖŸÑÿ©' : 'Completed cases' %></h2>
            <p class="section-hint">
              <%= isAr
                ? 'ÿ≠ÿßŸÑÿßÿ™ ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇÿßÿ±Ÿäÿ±Ÿáÿß ŸÑŸÑÿ±ÿ¨Ÿàÿπ ÿßŸÑÿ≥ÿ±Ÿäÿπ.'
                : 'Previously submitted cases for reference.'
              %>
            </p>

            <% if (completedCases && completedCases.length) { %>
              <div class="case-list muted">
                <% completedCases.forEach(function(c) { %>
                  <div class="case-row">
                    <div class="case-main">
                      <div class="case-ref"><%= c.reference %></div>
                      <div class="case-meta"><%= c.specialtyLabel %></div>
                    </div>

                    <div class="case-action">
                      <a href="<%= c.href %>" class="btn btn-outline">
                        <%= isAr ? 'ÿπÿ±ÿ∂' : 'View case' %>
                      </a>
                    </div>
                  </div>
                <% }); %>
              </div>
            <% } else { %>
              <p class="empty-state muted">
                <%= isAr
                  ? 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿßŸÑÿßÿ™ ŸÖŸÉÿ™ŸÖŸÑÿ© ÿ®ÿπÿØ.'
                  : 'No completed cases yet.'
                %>
              </p>
            <% } %>
          </section>

        </div>
      </div>
    </main>
  </div>
</body>
</html>
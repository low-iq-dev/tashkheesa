<%
  const activeCases = Array.isArray(locals.activeCases) ? locals.activeCases : [];
  const availableCases = Array.isArray(locals.availableCases) ? locals.availableCases : [];
  const completedCases = Array.isArray(locals.completedCases) ? locals.completedCases : [];
%>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Doctor Case Queue</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body class="doctor-worklist">

  <!-- HEADER -->
  <header class="portal-header">
    <div class="header-left">
      <strong>Tashkheesa</strong>
      <span class="header-sub">Doctor case queue</span>
    </div>

    <div class="header-actions">
      <a href="/doctor/queue" class="header-pill">Home</a>
      <a href="/doctor/alerts" class="header-pill">Alerts</a>
      <span class="header-pill muted">Dr Radiology</span>
      <a href="/logout" class="header-pill danger">Logout</a>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="worklist-container">

    <!-- ACTIVE CASES -->
    <section class="worklist-group">
      <div class="worklist-group-title">Active cases</div>

      <% if (activeCases.length === 0) { %>
        <div class="worklist-empty">No active cases.</div>
      <% } %>

      <% activeCases.forEach(c => { %>
        <div class="worklist-row">
          <div class="worklist-main">
            <strong><%= c.reference || c.id %></strong>
            <div class="muted"><%= c.specialtyLabel || c.specialty_name || c.service_name || '—' %></div>
          </div>

          <div class="worklist-action">
            <a href="<%= c.href || ('/portal/doctor/case/' + c.id) %>" class="btn-primary">Open</a>
          </div>
        </div>
      <% }) %>
    </section>

    <!-- AVAILABLE / NEW CASES -->
    <section class="worklist-group">
      <div class="worklist-group-title">Available / New cases</div>

      <% if (availableCases.length === 0) { %>
        <div class="worklist-empty">No available cases.</div>
      <% } %>

      <% availableCases.forEach(c => { %>
        <div class="worklist-row">
          <div class="worklist-main">
            <strong><%= c.reference || c.id %></strong>
            <div class="muted"><%= c.specialtyLabel || c.specialty_name || c.service_name || '—' %></div>
          </div>

          <div class="worklist-action">
            <form method="POST" action="/portal/doctor/case/<%= c.id %>/accept">
              <button type="submit" class="btn-primary">Accept</button>
            </form>
          </div>
        </div>
      <% }) %>
    </section>

    <!-- COMPLETED CASES -->
    <section class="worklist-group">
      <div class="worklist-group-title">Completed cases</div>

      <% if (completedCases.length === 0) { %>
        <div class="worklist-empty">No completed cases.</div>
      <% } %>

      <% completedCases.forEach(c => { %>
        <div class="worklist-row">
          <div class="worklist-main">
            <strong><%= c.reference || c.id %></strong>
            <div class="muted"><%= c.specialtyLabel || c.specialty_name || c.service_name || '—' %></div>
          </div>

          <div class="worklist-action">
            <a href="<%= c.href || ('/portal/doctor/case/' + c.id) %>" class="btn-primary">View</a>
          </div>
        </div>
      <% }) %>
    </section>

  </main>

</body>
</html>

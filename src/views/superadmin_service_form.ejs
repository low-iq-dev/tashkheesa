<%- include('partials/header', { title: "Service Details", layout: "portal", showNav: false }) %>
  <div class="layout">
    <header>
      <div class="brand">
        <div class="brand-logo">T</div>
        <div>
          <div class="brand-text-main"><%= brand %></div>
          <div class="brand-text-sub">Service Catalog</div>
        </div>
      </div>
      <div class="header-right">
        <a class="pill" href="/superadmin/services">Services</a>
        <a class="pill" href="/superadmin/alerts">
          <%= (typeof lang !== 'undefined' && lang === 'ar') ? 'التنبيهات' : 'Alerts' %>
          <% if (typeof hasUnseenAlerts !== 'undefined' && hasUnseenAlerts) { %>
            <span class="alert-dot" aria-label="<%= (typeof lang !== 'undefined' && lang === 'ar') ? 'تنبيهات غير مقروءة' : 'Unseen alerts' %>" title="<%= (typeof lang !== 'undefined' && lang === 'ar') ? 'تنبيهات غير مقروءة' : 'Unseen alerts' %>"></span>
          <% } %>
        </a>
        <div class="lang-switch" style="font-weight:700; opacity:.9;">
          <a href="/lang/en?next=<%= isEdit && service ? ('/superadmin/services/' + service.id + '/edit') : '/superadmin/services/new' %>">EN</a> | <a href="/lang/ar?next=<%= isEdit && service ? ('/superadmin/services/' + service.id + '/edit') : '/superadmin/services/new' %>">AR</a>
        </div>
        <%- include('partials/user_menu', { menuUser: user, isAr: (typeof lang !== 'undefined' && lang === 'ar'), profileHref: '/superadmin/profile' }) %>
      </div>
    </header>

    <main>
      <div class="page-shell">
        <div class="page-inner">
          <div class="page-heading" style="justify-content: space-between; align-items:center;">
            <div>
              <h1><%= isEdit ? 'Edit service' : 'Add service' %></h1>
              <p class="subtitle"><%= isEdit && service ? service.name : 'Manage service catalog entries.' %></p>
            </div>
            <a class="btn btn-outline" href="/superadmin/services">← Back</a>
          </div>

          <% if (error) { %>
            <div class="error"><%= error %></div>
          <% } %>

          <form class="card form-grid" method="post" action="<%= isEdit ? ('/superadmin/services/' + service.id + '/edit') : '/superadmin/services/new' %>">
            <%- (typeof csrfField === 'function') ? csrfField() : '' %>
            <div class="form-group">
              <label class="filter-label">Specialty *</label>
              <select name="specialty_id" required class="filter-select">
                <option value="">— Select —</option>
                <% (specialties || []).forEach(function(sp){ %>
                  <option value="<%= sp.id %>" <%= service && service.specialty_id === sp.id ? 'selected' : '' %>><%= sp.name %></option>
                <% }) %>
              </select>
            </div>
            <div class="form-group">
              <label class="filter-label">Name *</label>
              <input type="text" name="name" required value="<%= service && service.name ? service.name : '' %>" />
            </div>
            <div class="form-group">
              <label class="filter-label">Code</label>
              <input type="text" name="code" value="<%= service && service.code ? service.code : '' %>" />
            </div>
            <div class="form-group">
              <label class="filter-label">Base price</label>
              <input type="number" step="0.01" name="base_price" value="<%= service && service.base_price != null ? service.base_price : '' %>" />
            </div>
            <div class="form-group">
              <label class="filter-label">Doctor fee</label>
              <input type="number" step="0.01" name="doctor_fee" value="<%= service && service.doctor_fee != null ? service.doctor_fee : '' %>" />
            </div>
            <div class="form-group">
              <label class="filter-label">Currency</label>
              <select name="currency" class="filter-select">
                <% var curr = (service && service.currency) ? service.currency : 'EGP'; %>
                <option value="EGP" <%= curr === 'EGP' ? 'selected' : '' %>>EGP</option>
                <option value="USD" <%= curr === 'USD' ? 'selected' : '' %>>USD</option>
                <option value="EUR" <%= curr === 'EUR' ? 'selected' : '' %>>EUR</option>
              </select>
            </div>
            <div class="form-group" style="grid-column:1 / -1;">
              <label class="filter-label">Payment link</label>
              <input type="text" name="payment_link" value="<%= service && service.payment_link ? service.payment_link : '' %>" />
            </div>
            <div class="form-group" style="grid-column:1 / -1; display:flex; justify-content:flex-end;">
              <button type="submit" class="btn btn-primary"><%= isEdit ? 'Save changes' : 'Create service' %></button>
            </div>
          </form>
        </div>
      </div>
    </main>
  </div>

<%- include('partials/footer') %>

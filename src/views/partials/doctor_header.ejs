<%
  // brand, user, isAr, activeTab ('dashboard'|'alerts'|'profile'|'case'), nextPath
  const doctorName = (user && (user.display_name || user.name)) ? (user.display_name || user.name) : (isAr ? 'الطبيب' : 'Doctor');
  const safeNext = (typeof nextPath === 'string' && nextPath.startsWith('/')) ? nextPath : '/portal/doctor';
  const alertsUnseen = (typeof alertsUnseenCount !== 'undefined' && alertsUnseenCount != null) ? (Number(alertsUnseenCount) || 0) : 0;
%>
<%
  // Optional UI banner locals (set by route handlers when needed)
  // Example: res.render(..., { uiBanner: { type: 'success'|'error'|'info', message: '...' } })
  const uiBannerObj = (typeof uiBanner !== 'undefined' && uiBanner) ? uiBanner : null;
  const uiBannerType = uiBannerObj && uiBannerObj.type ? String(uiBannerObj.type) : '';
  const uiBannerMessage = uiBannerObj && uiBannerObj.message ? String(uiBannerObj.message) : '';
%>

<header role="banner">
  <div class="brand">
    <div class="brand-logo">T</div>
    <div>
      <div class="brand-text-main"><%= brand %></div>
      <div class="brand-text-sub"><%= isAr ? 'بوابة الطبيب' : 'Doctor portal' %></div>
    </div>
  </div>

  <div class="header-right">
    <a class="pill <%= activeTab === 'dashboard' ? 'active' : '' %>"
       href="/portal/doctor"
       <%= activeTab === 'dashboard' ? 'aria-current="page"' : '' %>>
      <%= isAr ? 'لوحة التحكم' : 'Dashboard' %>
    </a>

    <a class="pill <%= activeTab === 'alerts' ? 'active' : '' %>"
       href="/portal/doctor/alerts"
       <%= activeTab === 'alerts' ? 'aria-current="page"' : '' %>>
      <%= isAr ? 'التنبيهات' : 'Alerts' %>
      <% if (alertsUnseen > 0) { %>
        <span class="alert-dot" aria-label="<%= isAr ? 'تنبيهات غير مقروءة' : 'Unseen alerts' %>" title="<%= isAr ? 'تنبيهات غير مقروءة' : 'Unseen alerts' %>"></span>
      <% } %>
    </a>

    <%- include('user_menu', {
      menuUser: user,
      isAr,
      profileHref: '/portal/doctor/profile',
      menuClass: activeTab === 'profile' ? 'active' : ''
    }) %>

    <span class="pill lang-switch">
      <a class="lang-link" href="/lang/en?next=<%= encodeURIComponent(safeNext) %>" aria-label="Switch to English">EN</a>
      |
      <a class="lang-link" href="/lang/ar?next=<%= encodeURIComponent(safeNext) %>" aria-label="التبديل إلى العربية">AR</a>
    </span>
  </div>
</header>

<% if (uiBannerMessage) { %>
  <div id="globalBanner" class="global-banner <%= uiBannerType %>" role="status" aria-live="polite" aria-atomic="true">
    <%= uiBannerMessage %>
  </div>
<% } else { %>
  <div id="globalBanner" class="global-banner" role="status" aria-live="polite" aria-atomic="true" style="display:none;"></div>
<% } %>

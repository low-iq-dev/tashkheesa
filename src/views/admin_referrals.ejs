<%- include('partials/header', { title: pageTitle || "Referral Analytics", layout: "portal", showNav: false, portalFrame: true, portalRole: (typeof portalRole !== 'undefined' ? portalRole : 'superadmin'), portalActive: 'referrals' }) %>
<%
  var _lang = (typeof lang !== 'undefined') ? lang : 'en';
  var _isAr = (typeof isAr !== 'undefined') ? isAr : false;
  var _codes = (typeof codes !== 'undefined' && Array.isArray(codes)) ? codes : [];
  var _totalCodes = (typeof totalCodes !== 'undefined') ? totalCodes : 0;
  var _totalRedemptions = (typeof totalRedemptions !== 'undefined') ? totalRedemptions : 0;
  var _totalRewarded = (typeof totalRewarded !== 'undefined') ? totalRewarded : 0;
%>

<div class="admin-page">
  <div class="admin-page-header">
    <div class="admin-page-header-left">
      <nav class="admin-breadcrumb">
        <a href="/admin">Dashboard</a>
        <span class="admin-breadcrumb-sep">&rsaquo;</span>
        <span>Referrals</span>
      </nav>
      <h1 class="admin-page-title"><%= _isAr ? 'تحليلات الإحالات' : 'Referral Analytics' %></h1>
    </div>
    <div class="admin-page-header-right">
    </div>
  </div>

  <div class="admin-kpi-row">
    <div class="admin-kpi">
      <div class="admin-kpi-label"><%= _isAr ? 'إجمالي الأكواد' : 'Total Codes' %></div>
      <div class="admin-kpi-value"><%= _totalCodes %></div>
    </div>
    <div class="admin-kpi">
      <div class="admin-kpi-label"><%= _isAr ? 'إجمالي الإحالات' : 'Total Redemptions' %></div>
      <div class="admin-kpi-value"><%= _totalRedemptions %></div>
    </div>
    <div class="admin-kpi">
      <div class="admin-kpi-label"><%= _isAr ? 'مكافآت ممنوحة' : 'Rewards Granted' %></div>
      <div class="admin-kpi-value"><%= _totalRewarded %></div>
    </div>
  </div>

  <div class="admin-table-wrap">
    <table class="admin-table">
      <thead>
        <tr>
          <th><%= _isAr ? 'الكود' : 'Code' %></th>
          <th><%= _isAr ? 'المستخدم' : 'User' %></th>
          <th><%= _isAr ? 'مرات الاستخدام' : 'Uses' %></th>
          <th><%= _isAr ? 'المكافأة' : 'Reward' %></th>
          <th><%= _isAr ? 'الحالة' : 'Status' %></th>
        </tr>
      </thead>
      <tbody>
        <% if (_codes.length === 0) { %>
          <tr><td colspan="5" class="empty"><%= _isAr ? 'لا توجد أكواد' : 'No referral codes yet' %></td></tr>
        <% } %>
        <% _codes.forEach(function(c) { %>
          <tr>
            <td><code class="mono"><%= c.code %></code></td>
            <td><%= c.user_name || c.user_email || '-' %></td>
            <td><%= c.times_used %></td>
            <td><%= c.reward_value %>% <%= c.reward_type %></td>
            <td>
              <% if (c.is_active) { %>
                <span class="status-pill status-pill--completed">
                  <%= _isAr ? 'نشط' : 'Active' %>
                </span>
              <% } else { %>
                <span class="status-pill status-pill--breached">
                  <%= _isAr ? 'معطل' : 'Inactive' %>
                </span>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>
</div>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

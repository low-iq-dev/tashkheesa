<%- include('partials/header', { title: "Create Order", layout: "portal", showNav: true, showFooter: false, portalFrame: true, portalRole: 'superadmin', portalActive: 'dashboard', portalNext: '/superadmin/orders/new' }) %>
<%
  const isAr = (typeof lang !== 'undefined' && lang === 'ar');
  const brandSafe = (typeof brand !== 'undefined' && brand) ? brand : 'Tashkheesa';
%>
      <div class="portal-page portal-superadmin-order-new">
        <div class="portal-page-header">
          <div class="portal-page-titleblock">
            <div class="portal-page-kicker"><%= isAr ? 'بوابة المشرف' : 'Superadmin Portal' %></div>
            <h1 class="portal-page-title">Create Order</h1>
            <p class="portal-page-subtitle">Manually create a new case for a patient and assign it to a doctor.</p>
          </div>
          <div class="portal-page-actions">
            <a class="btn btn-secondary" href="/superadmin">&larr; Back to dashboard</a>
          </div>
        </div>

        <nav class="portal-top-tabs" aria-label="Superadmin navigation">
          <a href="/superadmin" class="active"><%= isAr ? 'لوحة التحكم' : 'Dashboard' %></a>
          <a href="/superadmin/doctors"><%= isAr ? 'الأطباء' : 'Doctors' %></a>
          <a href="/superadmin/services"><%= isAr ? 'الخدمات' : 'Services' %></a>
          <a href="/superadmin/events"><%= isAr ? 'سجل التدقيق' : 'Audit Log' %></a>
          <a href="/superadmin/alerts"><%= isAr ? 'التنبيهات' : 'Alerts' %></a>
        </nav>

        <% if (error) { %>
          <div class="portal-card" style="margin-top:12px;">
            <div class="error"><%= error %></div>
          </div>
        <% } %>

        <form class="portal-card card form-grid" style="margin-top:12px;" method="post" action="/superadmin/orders">
          <%- (typeof csrfField === 'function') ? csrfField() : '' %>
          <div class="form-group">
            <label class="filter-label">Patient *</label>
            <select name="patient_id" required class="filter-select">
              <option value="">Select patient</option>
              <% (patients || []).forEach(function(p) { %>
                <option value="<%= p.id %>"><%= p.name || 'Patient' %> – <%= p.email %></option>
              <% }) %>
            </select>
          </div>

          <div class="form-group">
            <label class="filter-label">Doctor</label>
            <select name="doctor_id" class="filter-select">
              <option value="">Unassigned (auto-assign if available)</option>
              <% (doctors || []).sort(function(a,b){ return (a.name||'').localeCompare(b.name||''); }).forEach(function(d) { %>
                <option value="<%= d.id %>"><%= d.name || 'Doctor' %> – <%= d.email %></option>
              <% }) %>
            </select>
          </div>

          <div class="form-group">
            <label class="filter-label">Specialty *</label>
            <select name="specialty_id" required class="filter-select">
              <option value="">Select specialty</option>
              <% (specialties || []).forEach(function(s) { %>
                <option value="<%= s.id %>"><%= s.name %></option>
              <% }) %>
            </select>
          </div>

          <div class="form-group">
            <label class="filter-label">Service / Test *</label>
            <select name="service_id" required class="filter-select">
              <option value="">Select service</option>
              <% (services || []).forEach(function(sv) { %>
                <option value="<%= sv.id %>"><%= sv.name %><%= sv.code ? ' (' + sv.code + ')' : '' %></option>
              <% }) %>
            </select>
          </div>

          <div class="form-group">
            <label class="filter-label">SLA *</label>
            <select name="sla_hours" required class="filter-select">
              <option value="24">24 hours (VIP)</option>
              <option value="72" <%= defaults && defaults.sla_hours === 72 ? 'selected' : '' %>>72 hours (Standard)</option>
            </select>
          </div>

          <div class="form-group">
            <label class="filter-label">Price (EGP)</label>
            <input type="number" step="0.01" name="price" class="filter-input" value="<%= (defaults && defaults.price) || '' %>" />
          </div>

          <div class="form-group">
            <label class="filter-label">Doctor fee (EGP)</label>
            <input type="number" step="0.01" name="doctor_fee" class="filter-input" value="<%= (defaults && defaults.doctor_fee) || '' %>" />
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label class="filter-label">Internal notes</label>
            <textarea name="notes" rows="4" class="filter-input"><%= (defaults && defaults.notes) || '' %></textarea>
          </div>

          <div class="form-group" style="grid-column: 1 / -1; display:flex; justify-content:flex-end; margin-top:8px;">
            <button type="submit" class="btn btn-primary">Create order</button>
          </div>
        </form>
      </div>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

<%- include('partials/header', { title: "Create Order", layout: "portal", showNav: true, showFooter: false, portalFrame: true, portalRole: 'superadmin', portalActive: 'dashboard', portalNext: '/superadmin/orders/new' }) %>
<%
  const isAr = (typeof lang !== 'undefined' && lang === 'ar');
  const brandSafe = (typeof brand !== 'undefined' && brand) ? brand : 'Tashkheesa';
%>
      <div class="admin-page">
        <div class="admin-page-header">
          <div class="admin-page-header-left">
            <nav class="admin-breadcrumb">
              <a href="/superadmin">Dashboard</a>
              <span class="admin-breadcrumb-sep">&rsaquo;</span>
              <a href="/admin/orders"><%= isAr ? 'الحالات' : 'Cases' %></a>
              <span class="admin-breadcrumb-sep">&rsaquo;</span>
              <span>Create Order</span>
            </nav>
            <h1 class="admin-page-title">Create Order</h1>
            <p class="admin-page-subtitle">Manually create a new case for a patient and assign it to a doctor.</p>
          </div>
          <div class="admin-page-header-right">
            <a class="admin-btn admin-btn-outline" href="/superadmin">&larr; Back to dashboard</a>
          </div>
        </div>

        <% if (error) { %>
          <div class="admin-card">
            <div class="admin-card-body">
              <div class="error"><%= error %></div>
            </div>
          </div>
        <% } %>

        <form class="admin-card" method="post" action="/superadmin/orders">
          <div class="admin-card-body">
            <%- (typeof csrfField === 'function') ? csrfField() : '' %>
            <div class="admin-form-grid">
              <div class="admin-form-group">
                <label class="filter-label">Patient *</label>
                <select name="patient_id" required class="filter-select">
                  <option value="">Select patient</option>
                  <% (patients || []).forEach(function(p) { %>
                    <option value="<%= p.id %>"><%= p.name || 'Patient' %> – <%= p.email %></option>
                  <% }) %>
                </select>
              </div>

              <div class="admin-form-group">
                <label class="filter-label">Doctor</label>
                <select name="doctor_id" class="filter-select">
                  <option value="">Unassigned (auto-assign if available)</option>
                  <% (doctors || []).sort(function(a,b){ return (a.name||'').localeCompare(b.name||''); }).forEach(function(d) { %>
                    <option value="<%= d.id %>"><%= d.name || 'Doctor' %> – <%= d.email %></option>
                  <% }) %>
                </select>
              </div>

              <div class="admin-form-group">
                <label class="filter-label">Specialty *</label>
                <select name="specialty_id" required class="filter-select">
                  <option value="">Select specialty</option>
                  <% (specialties || []).forEach(function(s) { %>
                    <option value="<%= s.id %>"><%= s.name %></option>
                  <% }) %>
                </select>
              </div>

              <div class="admin-form-group">
                <label class="filter-label">Service / Test *</label>
                <select name="service_id" required class="filter-select">
                  <option value="">Select service</option>
                  <% (services || []).forEach(function(sv) { %>
                    <option value="<%= sv.id %>"><%= sv.name %><%= sv.code ? ' (' + sv.code + ')' : '' %></option>
                  <% }) %>
                </select>
              </div>

              <div class="admin-form-group">
                <label class="filter-label">SLA *</label>
                <select name="sla_hours" required class="filter-select">
                  <option value="24">24 hours (VIP)</option>
                  <option value="72" <%= defaults && defaults.sla_hours === 72 ? 'selected' : '' %>>72 hours (Standard)</option>
                </select>
              </div>

              <div class="admin-form-group">
                <label class="filter-label">Price (EGP)</label>
                <input type="number" step="0.01" name="price" class="filter-input" value="<%= (defaults && defaults.price) || '' %>" />
              </div>

              <div class="admin-form-group">
                <label class="filter-label">Doctor fee (EGP)</label>
                <input type="number" step="0.01" name="doctor_fee" class="filter-input" value="<%= (defaults && defaults.doctor_fee) || '' %>" />
              </div>

              <div class="admin-form-group" style="grid-column: 1 / -1;">
                <label class="filter-label">Internal notes</label>
                <textarea name="notes" rows="4" class="filter-input"><%= (defaults && defaults.notes) || '' %></textarea>
              </div>

              <div class="admin-form-group" style="grid-column: 1 / -1; display:flex; justify-content:flex-end; margin-top:8px;">
                <button type="submit" class="admin-btn admin-btn-primary">Create order</button>
              </div>
            </div>
          </div>
        </form>
      </div>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

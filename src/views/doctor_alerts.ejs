<!DOCTYPE html>
<% const isAr = (typeof lang !== 'undefined' && lang === 'ar'); %>
<html lang="<%= lang || 'en' %>" dir="<%= isAr ? 'rtl' : 'ltr' %>">
<head>
  <meta charset="utf-8" />
  <title><%= isAr ? 'ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™' : 'Alerts' %> ‚Äì <%= brand %></title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="doctor-alerts <%= isAr ? 'rtl' : '' %>">
  <a class="skip-link" href="#main-content"><%= isAr ? 'ÿßŸÜÿ™ŸÇŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä' : 'Skip to main content' %></a>
  <% var fmtDate = (typeof formatEventDate !== 'undefined') ? formatEventDate : function(iso){ return iso || ''; }; %>
  <div class="layout">
    <header>
      <div class="brand">
        <div class="brand-logo">T</div>
        <div>
          <div class="brand-text-main"><%= brand %></div>
          <div class="brand-text-sub"><%= isAr ? 'ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ®' : 'Doctor Alerts' %></div>
        </div>
      </div>
      <div class="header-right">
        <a class="pill" href="/portal/doctor"><%= isAr ? 'ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ' : 'Dashboard' %></a>
        <span class="pill" aria-current="page"><%= isAr ? 'ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™' : 'Alerts' %></span>
        <div class="pill">üë®‚Äç‚öïÔ∏è <span><%= (user && user.name) || (isAr ? 'ÿßŸÑÿ∑ÿ®Ÿäÿ®' : 'Doctor') %></span></div>
        <span class="pill lang-switch">
          <a class="lang-link" href="/lang/en?next=/portal/doctor/alerts" aria-label="Switch to English">EN</a>
          |
          <a class="lang-link" href="/lang/ar?next=/portal/doctor/alerts" aria-label="ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©">AR</a>
        </span>
        <form class="logout-form" method="post" action="/logout">
          <%- (typeof csrfField === 'function') ? csrfField() : '' %>
          <button type="submit"><%= isAr ? 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨' : 'Logout' %></button>
        </form>
      </div>
    </header>

    <main id="main-content">
      <div class="page-shell">
        <div class="page-inner">
          <div class="page-heading">
            <div>
              <h1><%= isAr ? 'ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™' : 'Alerts' %></h1>
              <p class="subtitle">
                <%= isAr ? 'ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸÖÿ™ÿπŸÑŸÇÿ© ÿ®ÿ≠ÿßŸÑÿßÿ™ŸÉ ÿßŸÑÿ∑ÿ®Ÿäÿ©.' : 'Notifications related to your cases.' %>
              </p>
            </div>
            <a class="btn btn-outline" href="/portal/doctor">‚Üê <%= isAr ? 'ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ' : 'Back to dashboard' %></a>
          </div>

          <div class="card">
            <% if (!notifications || !notifications.length) { %>
              <p class="muted" style="margin:0;"><%= isAr ? 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿ≠ÿ™Ÿâ ÿßŸÑÿ¢ŸÜ.' : 'No alerts yet.' %></p>
            <% } else { %>
              <table>
                <thead>
                  <tr>
                    <th><%= isAr ? 'ŸÜŸàÿπ ÿßŸÑÿ™ŸÜÿ®ŸäŸá' : 'Notification type' %></th>
                    <th><%= isAr ? 'ÿßŸÑÿ≠ÿßŸÑÿ©' : 'Case' %></th>
                    <th><%= isAr ? 'ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ©' : 'Status' %></th>
                    <th><%= isAr ? 'ÿßŸÑŸàŸÇÿ™' : 'Time' %></th>
                  </tr>
                </thead>
                <tbody>
                  <% notifications.forEach(function(n){ %>
                    <% const isObj = n && typeof n === 'object'; %>
                    <% const template = isObj ? (n.template || 'alert') : 'info'; %>
                    <% const orderId = isObj ? (n.order_id || '') : ''; %>
                    <% const statusText = isObj ? (n.status || '') : ''; %>
                    <% const atIso = isObj ? (n.at || '') : ''; %>
                    <tr>
                      <td><%= template %></td>
                      <td>
                        <% if (orderId) { %>
                          <a href="/portal/doctor/case/<%= orderId %>"><%= orderId %></a>
                        <% } else { %>
                          <span class="muted">‚Äî</span>
                        <% } %>
                      </td>
                      <td><%= statusText || '‚Äî' %></td>
                      <td><%= atIso ? fmtDate(atIso) : '‚Äî' %></td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            <% } %>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>
</html>

<%
  const baseTitle = (typeof title !== 'undefined' && title) ? String(title) : 'Tashkheesa';
  const pageTitle = baseTitle.includes('Tashkheesa') ? baseTitle : `${baseTitle} â€“ Tashkheesa`;
  const pageLang = (typeof lang !== 'undefined' && lang)
    ? lang
    : ((typeof locals !== 'undefined' && locals && locals.lang)
        ? locals.lang
        : ((typeof locals !== 'undefined' && locals && locals.user && locals.user.lang)
            ? locals.user.lang
            : 'en'));
  const pageDir = (String(pageLang).toLowerCase() === 'ar') ? 'rtl' : 'ltr';
  const renderNav = (typeof showNav === 'undefined') ? true : Boolean(showNav);

  // SEO & Open Graph
  const siteUrl = 'https://tashkheesa.com';
  const ogImage = siteUrl + '/assets/brand/og-image.png';
  const defaultDesc = 'Get a specialist medical second opinion from board-certified Egyptian consultants. Upload your scans, labs, or reports and receive a written review within 72 hours.';
  const pageDesc = (typeof description !== 'undefined' && description) ? String(description) : defaultDesc;
  const canonicalPath = (typeof canonical !== 'undefined' && canonical) ? String(canonical) : '';
%>
<!DOCTYPE html>
<html lang="<%= pageLang %>" dir="<%= pageDir %>">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= pageTitle %></title>

  <!-- SEO -->
  <meta name="description" content="<%= pageDesc %>" />
  <meta name="robots" content="index, follow" />
  <% if (canonicalPath) { %><link rel="canonical" href="<%= siteUrl + canonicalPath %>" /><% } %>

  <!-- Open Graph (Facebook / WhatsApp / LinkedIn) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Tashkheesa" />
  <meta property="og:title" content="<%= pageTitle %>" />
  <meta property="og:description" content="<%= pageDesc %>" />
  <meta property="og:image" content="<%= ogImage %>" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <% if (canonicalPath) { %><meta property="og:url" content="<%= siteUrl + canonicalPath %>" /><% } %>
  <meta property="og:locale" content="<%= pageLang === 'ar' ? 'ar_EG' : 'en_US' %>" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="<%= pageTitle %>" />
  <meta name="twitter:description" content="<%= pageDesc %>" />
  <meta name="twitter:image" content="<%= ogImage %>" />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/css/portal-variables.css" />
  <link rel="stylesheet" href="/css/portal-components.css" />
  <link rel="stylesheet" href="/css/portal-global.css" />
  <link rel="stylesheet" href="https://unpkg.com/lucide-static/font/lucide.css">
  <script>
    (function () {
      try {
        var el = document.createElement('i');
        el.className = 'lucide lucide-bell';
        el.style.position = 'absolute';
        el.style.left = '-9999px';
        el.style.top = '-9999px';
        document.documentElement.appendChild(el);
        var ff = (window.getComputedStyle(el).fontFamily || '').toLowerCase();
        el.remove();
        if (ff.indexOf('lucide') !== -1) document.documentElement.classList.add('lucide-ready');
      } catch (e) {}
    })();
  </script>
  <link rel="icon" href="/favicon.ico" />
</head>
<body class="layout layout-public">

<% if (renderNav) { %>
<header class="site-header">
  <div class="header-inner">
    <a href="/" class="site-brand">
      <img
        src="/assets/brand/tashkheesa-logo-white-horizontal.png"
        alt="Tashkheesa"
        class="brand-logo-img"
      />
    </a>

    <nav class="main-nav">
      <ul class="nav-list">
        <li><a href="/services" class="nav-link">Services</a></li>
        <li><a href="/about" class="nav-link">About</a></li>
        <li><a href="/contact" class="nav-link">Contact</a></li>

        <li class="nav-dropdown">
          <span class="nav-link">Portal</span>
          <ul class="nav-dropdown-menu">
            <li><a href="/login" class="nav-link">Patient Portal</a></li>
            <li><a href="/portal/doctor" class="nav-link">Doctor Portal</a></li>
            <li><a href="/portal/admin" class="nav-link">Admin</a></li>
            <li><a href="/portal/superadmin" class="nav-link">Superadmin</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>
<% } %>

<main id="main-content" class="app-shell">

<%- include('partials/header', { title: "Doctors", layout: "portal", showNav: true, showFooter: false, portalFrame: true, portalRole: 'superadmin', portalActive: 'doctors', portalNext: '/superadmin/doctors' }) %>
<%
  var pendingDocs = typeof pendingDoctorsCount !== 'undefined' ? pendingDoctorsCount : 0;
  var statusFilter = typeof statusFilter !== 'undefined' ? statusFilter : 'all';
  var langNextHref = '/superadmin/doctors' + (statusFilter && statusFilter !== 'all' ? ('?status=' + encodeURIComponent(statusFilter)) : '');
  const isAr = (typeof lang !== 'undefined' && lang === 'ar');
  const brandSafe = (typeof brand !== 'undefined' && brand) ? brand : 'Tashkheesa';

  function statusBadge(doc) {
    if (doc.pending_approval) return '<span class="status-pill status-pill--new">Pending</span>';
    if (!doc.is_active && doc.rejection_reason) return '<span class="status-pill status-pill--breached">Rejected</span>';
    if (!doc.is_active) return '<span class="status-pill status-pill--new">Inactive</span>';
    return '<span class="status-pill status-pill--completed">Approved</span>';
  }
%>
      <div class="admin-page">
        <div class="admin-page-header">
          <div class="admin-page-header-left">
            <nav class="admin-breadcrumb">
              <a href="/superadmin">Dashboard</a>
              <span class="admin-breadcrumb-sep">&rsaquo;</span>
              <span><%= isAr ? 'الأطباء' : 'Doctors' %></span>
            </nav>
            <h1 class="admin-page-title"><%= isAr ? 'الأطباء' : 'Doctors' %></h1>
            <p class="admin-page-subtitle"><%= isAr ? 'إدارة حسابات الأطباء لعمليات الانضمام الداخلية.' : 'Manage doctor accounts' %></p>
          </div>
          <div class="admin-page-header-right">
            <a class="admin-btn admin-btn-primary" href="/superadmin/doctors/new">+ <%= isAr ? 'إضافة طبيب' : 'Add doctor' %></a>
          </div>
        </div>

        <section class="admin-card">
          <div class="admin-card-body">
            <div class="portal-filter-chips">
              <% ['all','pending','approved','rejected','inactive'].forEach(function(tab){ %>
                <a class="portal-filter-chip <%= statusFilter === tab ? 'active' : '' %>" href="/superadmin/doctors?status=<%= tab %>">
                  <%= tab.charAt(0).toUpperCase() + tab.slice(1) %>
                  <% if (tab === 'pending' && pendingDocs > 0) { %>
                    <span class="status-pill status-pill--new"><%= pendingDocs %></span>
                  <% } %>
                </a>
              <% }); %>
            </div>
          </div>
        </section>

        <section class="admin-card">
          <div class="admin-card-body">
            <div class="table-scroll table-scroll--y table-scroll--6">
              <table>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Specialty</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Notes</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% (doctors || []).forEach(function(d){ %>
                    <tr>
                      <td><%= d.name || 'Doctor' %></td>
                      <td><%= d.email %></td>
                      <td><%= d.specialty_name || '—' %></td>
                      <td><%= d.phone || '—' %></td>
                      <td><%- statusBadge(d) %></td>
                      <td><%= d.created_at || '—' %></td>
                      <td><%= d.signup_notes || '—' %></td>
                      <td>
                        <div class="admin-page-header-right">
                          <a class="admin-btn admin-btn-outline btn-small" href="/superadmin/doctors/<%= d.id %>">View</a>
                          <a class="admin-btn admin-btn-outline btn-small" href="/superadmin/doctors/<%= d.id %>/edit">Edit</a>
                          <% if (!d.pending_approval) { %>
                            <form method="post" action="/superadmin/doctors/<%= d.id %>/toggle">
                              <%- (typeof csrfField === 'function') ? csrfField() : '' %>
                              <button class="admin-btn admin-btn-outline btn-small" type="submit">
                                <%= d.is_active ? 'Deactivate' : 'Activate' %>
                              </button>
                            </form>
                          <% } %>
                        </div>
                      </td>
                    </tr>
                  <% }); %>
                  <% if (!doctors || !doctors.length) { %>
                    <tr><td colspan="8" class="empty">No doctors yet.</td></tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

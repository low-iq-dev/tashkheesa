<%- include('partials/header', { title: "Doctors", layout: "portal", showNav: true, showFooter: false, portalFrame: true, portalRole: 'superadmin', portalActive: 'doctors', portalNext: '/superadmin/doctors' }) %>
<%
  var pendingDocs = typeof pendingDoctorsCount !== 'undefined' ? pendingDoctorsCount : 0;
  var statusFilter = typeof statusFilter !== 'undefined' ? statusFilter : 'all';
  var langNextHref = '/superadmin/doctors' + (statusFilter && statusFilter !== 'all' ? ('?status=' + encodeURIComponent(statusFilter)) : '');
  const isAr = (typeof lang !== 'undefined' && lang === 'ar');
  const brandSafe = (typeof brand !== 'undefined' && brand) ? brand : 'Tashkheesa';

  function statusBadge(doc) {
    if (doc.pending_approval) return '<span class="status-pill status-pill--new">Pending</span>';
    if (!doc.is_active && doc.rejection_reason) return '<span class="status-pill status-pill--breached">Rejected</span>';
    if (!doc.is_active) return '<span class="status-pill status-pill--new">Inactive</span>';
    return '<span class="status-pill status-pill--completed">Approved</span>';
  }
%>
      <div class="portal-page portal-superadmin-doctors portal-doctor-list">
        <div class="portal-page-header">
          <div class="portal-page-titleblock">
            <div class="portal-page-kicker"><%= isAr ? 'بوابة المشرف' : 'Superadmin Portal' %></div>
            <h1 class="portal-page-title"><%= isAr ? 'الأطباء' : 'Doctors' %></h1>
            <p class="portal-page-subtitle"><%= isAr ? 'إدارة حسابات الأطباء لعمليات الانضمام الداخلية.' : 'Manage doctor accounts for internal onboarding.' %></p>
          </div>
          <div class="portal-page-actions">
            <a class="btn btn-primary" href="/superadmin/doctors/new">+ <%= isAr ? 'إضافة طبيب' : 'Add doctor' %></a>
          </div>
        </div>

        <nav class="portal-top-tabs" aria-label="Superadmin navigation">
          <a href="/superadmin"><%= isAr ? 'لوحة التحكم' : 'Dashboard' %></a>
          <a href="/superadmin/doctors" class="active"><%= isAr ? 'الأطباء' : 'Doctors' %></a>
          <a href="/superadmin/services"><%= isAr ? 'الخدمات' : 'Services' %></a>
          <a href="/superadmin/events"><%= isAr ? 'سجل التدقيق' : 'Audit Log' %></a>
          <a href="/superadmin/alerts"><%= isAr ? 'التنبيهات' : 'Alerts' %></a>
        </nav>

        <section class="portal-card">
          <div class="portal-filter-chips">
            <% ['all','pending','approved','rejected','inactive'].forEach(function(tab){ %>
              <a class="portal-filter-chip <%= statusFilter === tab ? 'active' : '' %>" href="/superadmin/doctors?status=<%= tab %>">
                <%= tab.charAt(0).toUpperCase() + tab.slice(1) %>
                <% if (tab === 'pending' && pendingDocs > 0) { %>
                  <span class="status-pill status-pill--new"><%= pendingDocs %></span>
                <% } %>
              </a>
            <% }); %>
          </div>
        </section>

        <section class="portal-card" style="margin-top:12px;">
          <div class="table-scroll table-scroll--y table-scroll--6">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Specialty</th>
                  <th>Phone</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Notes</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% (doctors || []).forEach(function(d){ %>
                  <tr>
                    <td><%= d.name || 'Doctor' %></td>
                    <td><%= d.email %></td>
                    <td><%= d.specialty_name || '—' %></td>
                    <td><%= d.phone || '—' %></td>
                    <td><%- statusBadge(d) %></td>
                    <td><%= d.created_at || '—' %></td>
                    <td><%= d.signup_notes || '—' %></td>
                    <td>
                      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                        <a class="btn btn-outline btn-small" href="/superadmin/doctors/<%= d.id %>">View</a>
                        <a class="btn btn-outline btn-small" href="/superadmin/doctors/<%= d.id %>/edit">Edit</a>
                        <% if (!d.pending_approval) { %>
                          <form method="post" action="/superadmin/doctors/<%= d.id %>/toggle">
                            <%- (typeof csrfField === 'function') ? csrfField() : '' %>
                            <button class="btn btn-outline btn-small" type="submit">
                              <%= d.is_active ? 'Deactivate' : 'Activate' %>
                            </button>
                          </form>
                        <% } %>
                      </div>
                    </td>
                  </tr>
                <% }); %>
                <% if (!doctors || !doctors.length) { %>
                  <tr><td colspan="8" class="empty">No doctors yet.</td></tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </section>
      </div>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

<%- include('partials/header', { title: "Doctor Details", layout: "portal", showNav: true, showFooter: false, portalFrame: true, portalRole: 'superadmin', portalActive: 'doctors', portalNext: '/superadmin/doctors/' + (doctor && doctor.id ? doctor.id : '') }) %>
<%
  var pendingDocs = typeof pendingDoctorsCount !== 'undefined' ? pendingDoctorsCount : 0;
  const isAr = (typeof lang !== 'undefined' && lang === 'ar');
  const brandSafe = (typeof brand !== 'undefined' && brand) ? brand : 'Tashkheesa';
  const nextPathSafe = '/superadmin/doctors/' + doctor.id;

  function statusBadge(doc) {
    if (doc.pending_approval) return '<span class="status-pill status-pill--new">Pending</span>';
    if (!doc.is_active && doc.rejection_reason) return '<span class="status-pill status-pill--breached">Rejected</span>';
    if (!doc.is_active) return '<span class="status-pill status-pill--new">Inactive</span>';
    return '<span class="status-pill status-pill--completed">Approved</span>';
  }
%>
      <div class="portal-page portal-superadmin-doctor-detail">
        <div class="portal-page-header">
          <div class="portal-page-titleblock">
            <div class="portal-page-kicker"><%= isAr ? 'بوابة المشرف' : 'Superadmin Portal' %></div>
            <h1 class="portal-page-title"><%= doctor.name || 'Doctor' %></h1>
            <p class="portal-page-subtitle"><%= doctor.email %> <% if (doctor.specialty_name) { %>· <%= doctor.specialty_name %><% } %></p>
          </div>
          <div class="portal-page-actions">
            <a class="btn btn-secondary" href="/superadmin/doctors">&larr; Back</a>
          </div>
        </div>

        <nav class="portal-top-tabs" aria-label="Superadmin navigation">
          <a href="/superadmin"><%= isAr ? 'لوحة التحكم' : 'Dashboard' %></a>
          <a href="/superadmin/doctors" class="active"><%= isAr ? 'الأطباء' : 'Doctors' %></a>
          <a href="/superadmin/services"><%= isAr ? 'الخدمات' : 'Services' %></a>
          <a href="/superadmin/events"><%= isAr ? 'سجل التدقيق' : 'Audit Log' %></a>
          <a href="/superadmin/alerts"><%= isAr ? 'التنبيهات' : 'Alerts' %></a>
        </nav>

        <div class="grid two-cols">
          <section class="portal-card card">
            <div class="card-header">
              <div class="card-title">Profile</div>
              <div><%- statusBadge(doctor) %></div>
            </div>
            <ul class="events-list">
              <li><strong>Name:</strong> <%= doctor.name || '—' %></li>
              <li><strong>Email:</strong> <%= doctor.email || '—' %></li>
              <li><strong>Phone:</strong> <%= doctor.phone || '—' %></li>
              <li><strong>Specialty:</strong> <%= doctor.specialty_name || '—' %></li>
              <li><strong>Created:</strong> <%= doctor.created_at || '—' %></li>
              <li><strong>Approved at:</strong> <%= doctor.approved_at || '—' %></li>
              <% if (doctor.rejection_reason) { %>
                <li><strong>Rejection reason:</strong> <%= doctor.rejection_reason %></li>
              <% } %>
            </ul>
          </section>

          <section class="portal-card card">
            <div class="card-header">
              <div class="card-title">Approval</div>
            </div>
            <div class="muted" style="margin-bottom:8px;">Signup notes:</div>
            <div style="background:#f8fafc; padding:10px; border-radius:6px; min-height:60px;">
              <%= doctor.signup_notes || '—' %>
            </div>

            <% if (doctor.pending_approval || (!doctor.is_active && doctor.rejection_reason)) { %>
              <form method="post" action="/superadmin/doctors/<%= doctor.id %>/approve" style="margin-top:12px;">
                <%- (typeof csrfField === 'function') ? csrfField() : '' %>
                <button class="btn btn-primary" type="submit">Approve</button>
              </form>
            <% } %>

            <form method="post" action="/superadmin/doctors/<%= doctor.id %>/reject" style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
              <%- (typeof csrfField === 'function') ? csrfField() : '' %>
              <label style="font-size:12px; font-weight:700;">Reject (optional reason)</label>
              <textarea name="rejection_reason" rows="3" placeholder="Reason for rejection"><%= doctor.rejection_reason || '' %></textarea>
              <button class="btn btn-outline" type="submit">Reject</button>
            </form>
          </section>
        </div>
      </div>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

<%- include('partials/header', { title: "Admin Dashboard", layout: "portal", showNav: false, portalFrame: true, portalRole: (typeof portalRole !== 'undefined' ? portalRole : 'admin'), portalActive: 'dashboard' }) %>
  <% function formatEventDate(iso) {
    if (!iso) return '';
    const d = new Date(iso);
    const dd = String(d.getDate()).padStart(2, '0');
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const yyyy = String(d.getFullYear());
    let hh = d.getHours();
    const min = String(d.getMinutes()).padStart(2, '0');
    const ampm = hh >= 12 ? 'PM' : 'AM';
    hh = hh % 12;
    if (hh === 0) hh = 12;
    return `${dd}/${mm}/${yyyy} ${hh}:${min} ${ampm}`;
  } %>
  <%
  // Prevent EJS crash if filters or specialties were not passed
  var filters = (typeof filters !== 'undefined' && filters) ? filters : {};
  filters = { from: filters.from || '', to: filters.to || '', specialty: filters.specialty || 'all' };

  var specialties = (typeof specialties !== 'undefined' && specialties) ? specialties : [];

  // Safe defaults for KPIs + datasets
  var totalOrders = typeof totalOrders !== 'undefined' ? totalOrders : 0;
  var completedCount = typeof completedCount !== 'undefined' ? completedCount : 0;
  var breachedCount = typeof breachedCount !== 'undefined' ? breachedCount : 0;
  var onTimePercent = typeof onTimePercent !== 'undefined' ? onTimePercent : 0;
  var avgTatMinutes = typeof avgTatMinutes !== 'undefined' && avgTatMinutes !== null ? avgTatMinutes : '—';
  var events = (typeof events !== 'undefined' && events) ? events : [];
  var pendingDocs = typeof pendingDoctorsCount !== 'undefined' ? pendingDoctorsCount : 0;
  var pendingFileRequests = (typeof pendingFileRequests !== 'undefined' && pendingFileRequests) ? pendingFileRequests : [];
  var pendingFileRequestsCount = (typeof pendingFileRequestsCount !== 'undefined') ? pendingFileRequestsCount : ((pendingFileRequests && pendingFileRequests.length) ? pendingFileRequests.length : 0);
  var ordersList = (typeof ordersList !== 'undefined' && ordersList) ? ordersList : [];
  var slaRiskOrders = (typeof slaRiskOrders !== 'undefined' && slaRiskOrders) ? slaRiskOrders : [];
  var breachedOrders = (typeof breachedOrders !== 'undefined' && breachedOrders) ? breachedOrders : [];
  var slaEvents = (typeof slaEvents !== 'undefined' && slaEvents) ? slaEvents : [];

  // Safe defaults for new dashboard data
  var _pendingOrders = typeof pendingOrders !== 'undefined' ? pendingOrders : 0;
  var _activeDoctors = typeof activeDoctorsCount !== 'undefined' ? activeDoctorsCount : 0;
  var _openChatReports = typeof openChatReports !== 'undefined' ? openChatReports : 0;
  var _pendingRefundsCount = typeof pendingRefundsCount !== 'undefined' ? pendingRefundsCount : 0;
  var _pendingRefunds = (typeof pendingRefunds !== 'undefined' && pendingRefunds) ? pendingRefunds : [];
  var _pendingDocs = (typeof pendingDoctors !== 'undefined' && pendingDoctors) ? pendingDoctors : [];
  var _doctorNoShowsToday = typeof doctorNoShowsToday !== 'undefined' ? doctorNoShowsToday : 0;
  var _doctorNoShowsWeek = typeof doctorNoShowsWeek !== 'undefined' ? doctorNoShowsWeek : 0;
  var _addOnsPurchased = typeof addOnsPurchased !== 'undefined' ? addOnsPurchased : 0;
  var _sh = (typeof systemHealth !== 'undefined' && systemHealth) ? systemHealth : {};
  var _ns = (typeof notifStats !== 'undefined' && notifStats) ? notifStats : { total: 0, sent: 0, failed: 0, queued: 0 };
  var _fin = (typeof financials !== 'undefined' && financials) ? financials : {};

  var _mc = (typeof monthComparison !== 'undefined' && monthComparison) ? monthComparison : {};
  var _ordersChange = _mc.ordersChange || 0;
  function changeClass(val) { return val > 0 ? 'up' : (val < 0 ? 'down' : 'flat'); }
  function changeIcon(val) { return val > 0 ? '&#9650;' : (val < 0 ? '&#9660;' : '&#8212;'); }

  // Combine audit events + SLA events into a single, time-sorted feed
  var combinedEvents = [];
  try {
    combinedEvents = ([])
      .concat((events || []).map(function(ev){
        return { at: ev.at, label: ev.label, order_id: ev.order_id, _type: 'audit' };
      }))
      .concat((slaEvents || []).map(function(ev){
        return { at: ev.at, label: ev.label, order_id: ev.order_id, _type: 'sla' };
      }))
      .sort(function(a, b){
        var ta = a && a.at ? new Date(a.at).getTime() : 0;
        var tb = b && b.at ? new Date(b.at).getTime() : 0;
        return tb - ta;
      })
      .slice(0, 12);
  } catch (e) {
    combinedEvents = events || [];
  }

  function statusLabel(val) {
    switch((val || '').toLowerCase()) {
      case 'accepted': return 'Accepted';
      case 'in_review': return 'In Review';
      case 'completed': return 'Completed';
      case 'breached': return 'Breached';
      case 'new':
      default: return 'New';
    }
  }
  %>

  <!-- Sticky top bar -->
  <div class="admin-topbar">
    <div class="admin-topbar-left">
      <h1>Operations Dashboard</h1>
    </div>
    <div class="admin-topbar-right">
      <form class="admin-topbar-filters" method="get" action="/admin">
        <div class="filter-bar">
          <input type="date" name="from" value="<%= filters.from %>">
          <input type="date" name="to" value="<%= filters.to %>">
          <select name="specialty">
            <option value="all" <%= filters.specialty === 'all' ? 'selected' : '' %>>All specialties</option>
            <% specialties.forEach(function(sp){ %>
              <option value="<%= sp.id %>" <%= filters.specialty == sp.id ? 'selected' : '' %>><%= sp.name %></option>
            <% }); %>
          </select>
          <button type="submit">Apply</button>
        </div>
      </form>
    </div>
  </div>

  <div class="admin-page">

    <!-- Alert Strip (conditional) -->
    <% var alertCount = (_pendingRefundsCount || 0) + (_openChatReports || 0) + (breachedCount || 0); %>
    <% if (alertCount > 0) { %>
    <div class="admin-alert-strip">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      <% if (_openChatReports > 0) { %><a href="/admin/chat-moderation"><%= _openChatReports %> open report<%= _openChatReports > 1 ? 's' : '' %></a><% } %>
      <% if (_openChatReports > 0 && (_pendingRefundsCount > 0 || breachedCount > 0)) { %><span class="alert-sep">&middot;</span><% } %>
      <% if (_pendingRefundsCount > 0) { %><a href="#pending-refunds"><%= _pendingRefundsCount %> pending refund<%= _pendingRefundsCount > 1 ? 's' : '' %></a><% } %>
      <% if (_pendingRefundsCount > 0 && breachedCount > 0) { %><span class="alert-sep">&middot;</span><% } %>
      <% if (breachedCount > 0) { %><a href="/admin/orders?status=breached"><%= breachedCount %> SLA breach<%= breachedCount > 1 ? 'es' : '' %></a><% } %>
    </div>
    <% } %>

    <!-- Case KPIs (4+2 grid with icon boxes) -->
    <div class="admin-kpi-grid">
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon blue">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/></svg>
          </div>
        </div>
        <p class="kpi-label">Total Cases</p>
        <p class="kpi-value"><%= totalOrders %></p>
        <p class="kpi-change <%= changeClass(_ordersChange) %>"><%- changeIcon(_ordersChange) %> <%= Math.abs(_ordersChange) %>% vs last month</p>
      </div>
      <div class="kpi-card kpi-warning">
        <div class="kpi-header">
          <div class="kpi-icon amber">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          </div>
        </div>
        <p class="kpi-label">Pending</p>
        <p class="kpi-value"><%= _pendingOrders %></p>
        <p class="kpi-change flat">Awaiting action</p>
      </div>
      <div class="kpi-card kpi-success">
        <div class="kpi-header">
          <div class="kpi-icon green">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          </div>
        </div>
        <p class="kpi-label">Completed</p>
        <p class="kpi-value"><%= completedCount %></p>
        <p class="kpi-change flat">Reports delivered</p>
      </div>
      <div class="kpi-card kpi-danger">
        <div class="kpi-header">
          <div class="kpi-icon red">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
          </div>
        </div>
        <p class="kpi-label">Breached SLA</p>
        <p class="kpi-value"><%= breachedCount %></p>
        <p class="kpi-change flat">Missed deadlines</p>
      </div>
      <div class="kpi-card kpi-purple">
        <div class="kpi-header">
          <div class="kpi-icon purple">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          </div>
        </div>
        <p class="kpi-label">SLA On-Time</p>
        <p class="kpi-value"><%= onTimePercent %>%</p>
      </div>
      <div class="kpi-card kpi-teal">
        <div class="kpi-header">
          <div class="kpi-icon teal">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          </div>
        </div>
        <p class="kpi-label">Avg Turnaround</p>
        <p class="kpi-value"><%= avgTatMinutes %> min</p>
      </div>
    </div>

    <!-- Patient Issues (2x2 grid with icon boxes) -->
    <div class="admin-section-title">Patient Issues</div>
    <div class="admin-issues-grid">
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon red">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
          </div>
          <% if (_openChatReports > 0) { %><a href="/admin/chat-moderation" class="admin-btn admin-btn-sm admin-btn-outline">Review</a><% } %>
        </div>
        <p class="kpi-value"><%= _openChatReports %></p>
        <p class="kpi-label">Open Chat Reports</p>
      </div>
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon amber">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
          </div>
          <% if (_pendingRefundsCount > 0) { %><a href="#pending-refunds" class="admin-btn admin-btn-sm admin-btn-outline">Review</a><% } %>
        </div>
        <p class="kpi-value"><%= _pendingRefundsCount %></p>
        <p class="kpi-label">Pending Refund Requests</p>
      </div>
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon blue">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          </div>
        </div>
        <p class="kpi-value"><%= pendingFileRequestsCount %></p>
        <p class="kpi-label">File Re-upload Requests</p>
      </div>
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon purple">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
          </div>
        </div>
        <p class="kpi-value"><%= _doctorNoShowsToday %></p>
        <p class="kpi-label">No-Shows Today</p>
      </div>
    </div>

    <!-- Doctor Management (3 cards with icon boxes) -->
    <div class="admin-section-title">Doctor Management</div>
    <div class="admin-kpi-grid" style="grid-template-columns: repeat(3, 1fr);">
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon amber">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17 11 19 13 23 9"/></svg>
          </div>
          <% if (pendingDocs > 0) { %><a href="/superadmin/doctors?status=pending" class="admin-btn admin-btn-sm admin-btn-primary">Review</a><% } %>
        </div>
        <p class="kpi-value"><%= pendingDocs %></p>
        <p class="kpi-label">Pending Approvals</p>
      </div>
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon green">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
          </div>
        </div>
        <p class="kpi-value"><%= _activeDoctors %></p>
        <p class="kpi-label">Active Doctors</p>
      </div>
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon red">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
          </div>
        </div>
        <p class="kpi-value"><%= _doctorNoShowsWeek %></p>
        <p class="kpi-label">Doctor No-Shows This Week</p>
      </div>
    </div>

    <!-- Order Financials (limited — no revenue) -->
    <div class="admin-section-title">Order Financials</div>
    <div class="admin-kpi-grid" style="grid-template-columns: repeat(3, 1fr);">
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon red">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
          </div>
        </div>
        <p class="kpi-value"><%= Number(_fin.refundsThisMonth || 0).toLocaleString() %> EGP</p>
        <p class="kpi-label">Refunds This Month</p>
      </div>
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon blue">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
          </div>
        </div>
        <p class="kpi-value"><%= _addOnsPurchased %></p>
        <p class="kpi-label">Add-ons Purchased</p>
      </div>
      <div class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon teal">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
          </div>
        </div>
        <p class="kpi-value"><%= Number(_fin.pendingPayouts || 0).toLocaleString() %> EGP</p>
        <p class="kpi-label">Pending Dr Payouts</p>
      </div>
    </div>

    <!-- Main Content: Cases Table + Sidebar -->
    <div class="admin-grid-main">
      <!-- Left: Recent Cases Table -->
      <div>
        <div class="admin-card">
          <div class="admin-card-header">
            <h3>Recent Cases</h3>
            <a href="/admin/orders" class="admin-btn admin-btn-sm admin-btn-outline">View All</a>
          </div>
          <table class="admin-table">
            <thead>
              <tr>
                <th>Order</th>
                <th>Patient</th>
                <th>Doctor</th>
                <th>Service</th>
                <th>Status</th>
                <th class="align-right">Amount</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% (ordersList || []).forEach(function(o) { %>
                <%
                  var eff = o.effectiveStatus || o.status;
                  var statusUiLocal = o.statusUi || o.status_ui || null;
                  var effKey = statusUiLocal && (statusUiLocal.key || statusUiLocal.status)
                    ? String(statusUiLocal.key || statusUiLocal.status).toLowerCase()
                    : String(eff || '').toLowerCase();
                  var effLabel = statusUiLocal && (statusUiLocal.title || statusUiLocal.label)
                    ? (statusUiLocal.title || statusUiLocal.label)
                    : statusLabel(eff);
                %>
                <tr>
                  <td class="cell-bold"><a href="/admin/orders/<%= o.id %>"><small><%= o.id.slice(0, 8) %></small></a></td>
                  <td><%= o.patient_name || '—' %></td>
                  <td><%- o.doctor_name || '<span class="cell-muted">Unassigned</span>' %></td>
                  <td>
                    <%= o.service_name || '—' %>
                    <% if (o.specialty_name) { %><span class="cell-muted" style="display:block;"><%= o.specialty_name %></span><% } %>
                  </td>
                  <td>
                    <span class="status-pill status-pill--<%= effKey %>"><%= effLabel %></span>
                    <% if (o.reassigned_count && Number(o.reassigned_count) > 0) { %>
                      <span class="tag" style="margin-left:4px;">R<%= o.reassigned_count %></span>
                    <% } %>
                  </td>
                  <td class="align-right">
                    <% if (o.amount != null && Number(o.amount) > 0) { %>
                      <span class="cell-bold"><%= Number(o.amount).toLocaleString() %></span>
                      <% if (o.payment_status) { %><span class="cell-muted" style="display:block;"><%= o.payment_status %></span><% } %>
                    <% } else { %>
                      <span class="cell-muted">—</span>
                    <% } %>
                  </td>
                  <td><a class="admin-btn admin-btn-sm admin-btn-outline" href="/admin/orders/<%= o.id %>">View</a></td>
                </tr>
              <% }); %>
              <% if (!ordersList || !ordersList.length) { %>
                <tr><td colspan="7" class="empty">No orders yet.</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Right: SLA Risk + Activity Feed -->
      <div>
        <div class="admin-card" style="margin-bottom:16px;">
          <div class="admin-card-header"><h3>SLA Risk (24h)</h3></div>
          <div class="admin-card-body">
            <% if (slaRiskOrders && slaRiskOrders.length) { %>
              <ul class="events-list" style="margin:0;">
                <% slaRiskOrders.forEach(function(o){ %>
                  <li class="event-item">
                    <div class="event-label">Order <%= o.id %> &middot; <%= o.specialty_name || 'Specialty' %></div>
                    <div class="event-meta"><%= o.doctor_name || 'Unassigned' %> &middot; ~<%= Math.max(0, Math.floor(o.hours_remaining)) %>h remaining</div>
                  </li>
                <% }) %>
              </ul>
            <% } else { %>
              <p class="cell-muted" style="margin:0;">No orders nearing SLA in the next 24h.</p>
            <% } %>
          </div>
        </div>

        <div class="admin-card">
          <div class="admin-card-header"><h3>Live Activity</h3></div>
          <ul class="events-list">
            <% if (combinedEvents && combinedEvents.length) { %>
              <% combinedEvents.forEach(function(ev) { %>
                <li class="event-item">
                  <div class="event-label">
                    <% if (ev._type === 'sla') { %><span class="tag" style="margin-right:6px;">SLA</span><% } %>
                    <%= ev.label %>
                  </div>
                  <div class="event-meta">
                    <a href="/admin/orders/<%= ev.order_id %>"><%= ev.order_id %></a>
                    &middot; <%= formatEventDate(ev.at) %>
                  </div>
                </li>
              <% }); %>
            <% } else { %>
              <li class="event-item"><div class="event-meta">No activity recorded yet.</div></li>
            <% } %>
          </ul>
        </div>
      </div>
    </div>

    <!-- Pending Refund Requests (detail table) -->
    <% if (_pendingRefunds.length > 0) { %>
    <div class="admin-card" id="pending-refunds">
      <div class="admin-card-header">
        <h3>Pending Refund Requests (<%= _pendingRefunds.length %>)</h3>
      </div>
      <table class="admin-table">
        <thead>
          <tr>
            <th>Patient</th>
            <th>Doctor</th>
            <th>Amount</th>
            <th>Appointment</th>
          </tr>
        </thead>
        <tbody>
          <% _pendingRefunds.forEach(function(r) { %>
            <tr>
              <td><%= r.patient_name || '—' %></td>
              <td><%= r.doctor_name || '—' %></td>
              <td class="cell-bold"><%= Number(r.amount || 0).toLocaleString() %></td>
              <td><%= formatEventDate(r.scheduled_at) %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <% } %>

    <!-- System Strip (minimal with health dots) -->
    <div class="admin-system-strip">
      <span class="system-item">
        <span class="system-dot <%= (_sh.errorsLast24h > 0) ? 'system-dot--alert' : 'system-dot--ok' %>"></span>
        Errors (24h): <strong class="<%= (_sh.errorsLast24h > 0) ? 'system-val--alert' : '' %>"><%= _sh.errorsLast24h || 0 %></strong>
      </span>
      <span class="system-sep">&middot;</span>
      <span class="system-item">
        Notif. Failed: <strong class="<%= (_ns.failed > 0) ? 'system-val--alert' : '' %>"><%= _ns.failed || 0 %></strong>
      </span>
      <span class="system-sep">&middot;</span>
      <span class="system-item">
        Queued: <strong><%= _ns.queued || 0 %></strong>
      </span>
    </div>
  </div>

<script src="/js/tours/admin-tour.js" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  if (typeof PortalTour !== 'undefined' && !PortalTour.isDone('admin_dashboard')) {
    setTimeout(function() {
      PortalTour.showWelcome({
        tourId: 'admin_dashboard',
        mandatory: true,
        icon: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>',
        title: 'Welcome to the Command Center!',
        text: 'Take a quick tour of the admin dashboard to learn about KPIs, alerts, and system monitoring.',
        onStart: function() { PortalTour.start('admin_dashboard', adminDashboardTour); }
      });
    }, 1000);
  }
  window.startPortalTour = function() {
    PortalTour.reset('admin_dashboard');
    PortalTour.start('admin_dashboard', adminDashboardTour);
  };
});
</script>

<%- include('partials/footer', { showFooter: false, portalFrame: true }) %>

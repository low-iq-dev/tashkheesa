<%- include('partials/header', { title: "Payment", layout: "public", showNav: false }) %>
  <div class="page-shell">
    <div class="page-inner">
      <header class="flow-header">
        <div class="brand">
          <div class="brand-logo">T</div>
          <div>
            <div class="brand-text-main">Tashkheesa</div>
            <div class="brand-text-sub"><%= (typeof isAr !== 'undefined' && isAr) ? 'الدفع' : 'Payment' %></div>
          </div>
        </div>
        <div class="lang-switch">
          <a href="/lang/en?next=/order/<%= sessionToken %>/payment">EN</a> | 
          <a href="/lang/ar?next=/order/<%= sessionToken %>/payment">AR</a>
        </div>
      </header>

      <main>
        <div class="page-heading">
          <div>
            <h1><%= (typeof isAr !== 'undefined' && isAr) ? 'الدفع واختيار مدة المراجعة' : 'Payment &amp; SLA selection' %></h1>
            <p class="subtitle"><%= (typeof isAr !== 'undefined' && isAr) ? 'اختر مدة المراجعة المناسبة لدرجة الاستعجال ثم أكد الدفع.' : 'Choose the SLA that fits your urgency and confirm the payment.' %></p>
          </div>
        </div>

        <div class="flow-card">
          <section class="flow-section">
            <h3><%= (typeof isAr !== 'undefined' && isAr) ? 'البيانات الحالية' : 'Current details' %></h3>
            <ul class="flow-summary">
              <li><strong><%= (typeof isAr !== 'undefined' && isAr) ? 'السبب:' : 'Reason:' %></strong> <%= reason || ((typeof isAr !== 'undefined' && isAr) ? 'غير متوفر' : 'Not provided') %></li>
              <li><strong><%= (typeof isAr !== 'undefined' && isAr) ? 'درجة الاستعجال:' : 'Urgency flag:' %></strong> <%= urgency %></li>
              <li><strong><%= (typeof isAr !== 'undefined' && isAr) ? 'اللغة:' : 'Language:' %></strong> <%= language %></li>
            </ul>
          </section>


          <section class="flow-section">
            <h3><%= (typeof isAr !== 'undefined' && isAr) ? 'ماذا يحدث إذا تم تجاوز مدة المراجعة؟' : 'What happens if the SLA is missed?' %></h3>
            <p class="flow-note">
              <%= (typeof isAr !== 'undefined' && isAr)
                ? 'سيتم تصعيد الحالة تلقائياً إلى فريق إشراف، وسيتم إخطار الطبيب مرة أخرى، وإرسال رسالة متابعة لك.'
                : 'Cases are automatically escalated to a supervisor team, the specialist is notified again, and a follow-up message is sent to you.' %>
            </p>
          </section>

          <form method="post" action="/order/<%= sessionToken %>/confirmation" novalidate>
            <input type="hidden" name="sla_hours" id="sla_hours" value="72" />
            <%- (typeof csrfField === 'function') ? csrfField() : '' %>
            <section class="flow-section">
              <h3><%= (typeof isAr !== 'undefined' && isAr) ? 'اختر مدة المراجعة' : 'Select SLA' %></h3>
              <div class="sla-grid">
                <label class="sla-card">
                  <input type="radio" name="sla_choice" value="72" checked onclick="document.getElementById('sla_hours').value='72'" />
                  <span class="sla-title">Standard review · 72 hours</span>
                  <p>Specialist-reviewed written opinion delivered digitally.</p>
                  <p class="sla-detail">Auto-escalation kicks in if the SLA window is missed.</p>
                </label>
                <label class="sla-card">
                  <input type="radio" name="sla_choice" value="24" onclick="document.getElementById('sla_hours').value='24'" />
                  <span class="sla-title">Priority review · 24 hours</span>
                  <p>Assistant support coordinates any missing files for faster turnaround.</p>
                  <p class="sla-detail">Auto escalation includes SMS + WhatsApp alerts if the deadline is breached.</p>
                </label>
              </div>
            </section>
            <input type="hidden" name="file_names" value="<%= files.join('|') %>" />
            <input type="hidden" name="reason" value="<%= reason %>" />
            <input type="hidden" name="urgency" value="<%= urgency %>" />
            <input type="hidden" name="language" value="<%= language %>" />
            <div class="section-cta">
              <button type="submit" class="btn btn-primary"><%= (typeof isAr !== 'undefined' && isAr) ? 'تأكيد وإرسال' : 'Confirm &amp; Submit' %></button>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>
<%- include('partials/footer') %>
